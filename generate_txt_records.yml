---
- name: Extract dkim record value
  shell:
    cmd: "tr -d '\n' < /etc/dkimkeys/{{ domain }}/default.txt | sed -E 's/.+IN\\s+TXT\\s+//' | tr -d '()\"[:blank:]' | sed -E s/\\;--.+//"
  register: extract_dkim_result
  changed_when: false

- name: Create file to hold dkim text record
  template:
    src: templates/txt_record_template.j2
    dest: "~/dns_txt_records/{{ domain }}_dkim.txt"
  vars:
    key: "default._domainkey.{{ domain }}"
    value: "{{ extract_dkim_result.stdout }}"
